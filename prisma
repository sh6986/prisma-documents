# í”„ë¦¬ì¦ˆë§ˆë€?

# í”„ë¦¬ì¦ˆë§ˆë€?

ì˜¤í”ˆì†ŒìŠ¤ ì°¨ì„¸ëŒ€ ORMì´ë‹¤. ë‹¤ìŒ ë¶€ë¶„ìœ¼ë¡œ êµ¬ì„±ëœë‹¤.

- **Prisma Client** : Node.js ë° TypeScript ë¥¼ ìœ„í•œ ìë™ ìƒì„± ë° ìœ í˜• ì•ˆì „ ì¿¼ë¦¬ ë¹Œë”
- **Prisma Migrate** : ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œìŠ¤í…œ
- **Prisma Studio** : ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°ì´í„°ë¥¼ ë³´ê³  í¸ì§‘í•˜ëŠ” GUI

Prisma ClientëŠ” ëª¨ë“  Node.js ë˜ëŠ” TypeScript ë°±ì—”ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. REST API, GraphQL API, gRPC API ë˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ê°€ í•„ìš”í•œ ëª¨ë“  ê²ƒì´ ë  ìˆ˜ ìˆë‹¤.

# í”„ë¦¬ì¦ˆë§ˆëŠ” ì–´ë–»ê²Œ ì‘ë™í• ê¹Œ?

## í”„ë¦¬ì¦ˆë§ˆ ìŠ¤í‚¤ë§ˆ

Prisma íˆ´í‚·ì˜ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  í”„ë¡œì íŠ¸ëŠ” **Prisma ìŠ¤í‚¤ë§ˆ íŒŒì¼**ë¡œ ì‹œì‘í•œë‹¤. Prisma ìŠ¤í‚¤ë§ˆë¥¼ í†µí•´ ê°œë°œìëŠ” ì§ê´€ì ì¸ ë°ì´í„° ëª¨ë¸ë§ ì–¸ì–´ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ ëª¨ë¸ì„ ì •ì˜í•  ìˆ˜ ìˆë‹¤. ë˜í•œ ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•œ ì—°ê²°ì„ í¬í•¨í•˜ê³  ìƒì„±ê¸°ë¥¼ ì •ì˜í•œë‹¤.

```jsx
// ê´€ê³„í˜• ë°ì´í„° ë² ì´ìŠ¤
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Post {
  id        Int     @id @default(autoincrement())
  title     String
  content   String?
  published Boolean @default(false)
  author    User?   @relation(fields: [authorId], references: [id])
  authorId  Int?
}

model User {
  id    Int     @id @default(autoincrement())
  email String  @unique
  name  String?
  posts Post[]
}
```

```jsx
// MongoDB
datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Post {
  id        String  @id @default(auto()) @map("_id") @db.ObjectId
  title     String
  content   String?
  published Boolean @default(false)
  author    User?   @relation(fields: [authorId], references: [id])
  authorId  String  @db.ObjectId
}

model User {
  id    String  @id @default(auto()) @map("_id") @db.ObjectId
  email String  @unique
  name  String?
  posts Post[]
}
```

<aside>
ğŸ’¡ **ì°¸ê³ **
Prisma ìŠ¤í‚¤ë§ˆì—ëŠ” ê°•ë ¥í•œ ë°ì´í„° ëª¨ë¸ë§ ê¸°ëŠ¥ì´ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ Prisma Client API ì—ì„œ ê´€ê³„ ì‘ì—…ì„ ë” ì‰½ê²Œ í•  ìˆ˜ ìˆë„ë¡ â€œPrisma-levelâ€ ê´€ê³„ í•„ë“œë¥¼ ì •ì˜í•  ìˆ˜ ìˆë‹¤. User ëª¨ë¸ì˜ posts í•„ë“œì˜ ê²½ìš° â€œPrisma-levelâ€ì—ì„œë§Œ ì •ì˜ëœë‹¤. ì¦‰, ê¸°ë³¸ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì™¸ë˜ í‚¤ë¡œ ëª…ì‹œë˜ì§€ ì•ŠëŠ”ë‹¤.

</aside>

ì´ ìŠ¤í‚¤ë§ˆì—ì„œëŠ” ì„¸ ê°€ì§€ë¥¼ êµ¬ì„±í•œë‹¤.

- **Data source** : ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì„ ì§€ì •í•œë‹¤. (í™˜ê²½ ë³€ìˆ˜ë¥¼ í†µí•´)
- **Generator** : Prisma Clientë¥¼ ìƒì„±í•˜ê³ ì í•¨ì„ ë‚˜íƒ€ë‚¸ë‹¤.
- **Data model** : ì• í”Œë¦¬ì¼€ì´ì…˜ ëª¨ë¸ì„ ì •ì˜í•œë‹¤.

## Prisma Data model

### Prisma modelì˜ ê¸°ëŠ¥

Data modelì€ modelì˜ ëª¨ìŒì´ë‹¤. modelì—ëŠ” ë‘ ê°€ì§€ ì£¼ìš” ê¸°ëŠ¥ì´ ìˆë‹¤.

- ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì´ë¸” ë˜ëŠ” MongoDBì˜ ì»¬ë ‰ì…˜ì„ ë‚˜íƒ€ë‚¸ë‹¤.
- Prisma Client APIì—ì„œ ì¿¼ë¦¬ ê¸°ë°˜ ì œê³µ

### Data model ê°€ì ¸ì˜¤ê¸°

Data modelì„ Prisma ìŠ¤í‚¤ë§ˆë¡œ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ ë‘ ê°€ì§€ ì£¼ìš” ì›Œí¬í”Œë¡œê°€ ìˆë‹¤.

- ë°ì´í„° ëª¨ë¸ì„ ìˆ˜ë™ìœ¼ë¡œ ì‘ì„±í•˜ê³  Prisma Migrateë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì— ë§¤í•‘
- ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ê²€ì‚¬í•˜ì—¬ ë°ì´í„° ëª¨ë¸ ìƒì„±

Data modelì´ ì •ì˜ë˜ë©´ ì •ì˜ëœ ëª¨ë¸ì— ëŒ€í•œ CRUD ë° ë” ë§ì€ ì¿¼ë¦¬ë¥¼ ë…¸ì¶œí•˜ëŠ” Prisma Clientë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

TypeScriptë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ëª¨ë“  ì¿¼ë¦¬ì— ëŒ€í•´ ì™„ì „í•œ ìœ í˜• ì•ˆì „ì„±ì„ ì–»ì„ ìˆ˜ ìˆë‹¤. (ëª¨ë¸ í•„ë“œì˜ í•˜ìœ„ ì§‘í•©ë§Œ ê²€ìƒ‰í•˜ëŠ” ê²½ìš°ì—ë„)

## Prisma Clientë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•˜ê¸°

### Prisma Client ìƒì„±

```jsx
npm install @prisma/client
```

`@prisma/client` íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•˜ë©´ Prisma ìŠ¤í‚¤ë§ˆë¥¼ ì½ê³  Prisma Client ì½”ë“œë¥¼ ìƒì„±í•˜ëŠ” ëª…ë ¹ì–´ `prisma generate` ì´ í˜¸ì¶œëœë‹¤. ì½”ë“œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `node_modules/.prisma/client` í´ë”ì— ìƒì„±ëœë‹¤.

Data modelì„ ë³€ê²½í•œ í›„ `node_modules/.prisma/client` ë‚´ë¶€ ì½”ë“œê°€ ì—…ë°ì´íŠ¸ ë˜ë„ë¡ Prisma Clientë¥¼ ìˆ˜ë™ìœ¼ë¡œ ë‹¤ì‹œ ìƒì„±í•´ì•¼ í•œë‹¤.

```jsx
prisma generate
```

### Prisma Clientë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì— ì¿¼ë¦¬ ë³´ë‚´ê¸°

Prisma Clientê°€ ìƒì„±ë˜ë©´ ì½”ë“œë¥¼ ê°€ì ¸ì™€ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ì¿¼ë¦¬ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆë‹¤. ì´ê²ƒì´ ì„¤ì • ì½”ë“œì˜ ëª¨ìŠµì´ë‹¤.

***Prisma Client ê°€ì ¸ì˜¤ê¸° ë° ì¸ìŠ¤í„´ìŠ¤í™”***

```jsx
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();
```

ì´ì œ ìƒì„±ëœ Prisma Client APIë¥¼ í†µí•´ ì¿¼ë¦¬ ì „ì†¡ì„ ì‹œì‘í•  ìˆ˜ ìˆë‹¤.

***ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ëª¨ë“  User ë ˆì½”ë“œ ê²€ìƒ‰***

```jsx
const allUsers = await prisma.user.findMany();
```

***Userê°ì²´ì˜ posts ê´€ê³„ë¥¼ include***

```jsx
const allUsers = await prisma.user.findMany({
	include: { posts: true },
});
```

***â€œprismaâ€ ë¥¼ í¬í•¨í•˜ëŠ” ëª¨ë“  Post ë ˆì½”ë“œ í•„í„°ë§*** 

```jsx
const filteredPosts = await prisma.post.findMany({
	where: {
		OR: [
			{ title: { contains: 'prisma' } },
			{ content: { contains: 'prisma' } },
		],
	},
});
```

***ë™ì¼í•œ ì¿¼ë¦¬ì—ì„œ Userì™€ Post ìƒˆ ë ˆì½”ë“œ ë§Œë“¤ê¸°***

```jsx
const user = await prisma.user.create({
	data: {
		name: 'Alice',
		email: 'alice@prisma.io',
		posts: {
			create: { title: 'Join us for Prisma Day 2020' },
		},
	},
});
```

***ê¸°ì¡´ Post ë ˆì½”ë“œ ì—…ë°ì´íŠ¸***

```jsx
const post = await prisma.post.update({
	where: { id: 42 },
	data: { published: true },
});
```

### TypeScriptì™€ í•¨ê»˜ ì‚¬ìš©

TypeScriptë¥¼ ì‚¬ìš©í•  ë•Œ ì´ ì¿¼ë¦¬ì˜ ê²°ê³¼ëŠ” ì •ì ìœ¼ë¡œ ìœ í˜•ì´ ì§€ì •ë˜ë¯€ë¡œ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì†ì„±ì— ì‹¤ìˆ˜ë¡œ ì•¡ì„¸ìŠ¤ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ê·¸ë¦¬ê³  ëª¨ë“  ì˜¤íƒ€ëŠ” ì»´íŒŒì¼ íƒ€ì„ì— í¬ì°©ë¨) 

# ì¼ë°˜ì ì¸ Prisma ì‘ì—… íë¦„

ìœ„ì—ì„œ ì–¸ê¸‰í–ˆë“¯ì´ ë°ì´í„° ëª¨ë¸ì„ Prisma ìŠ¤í‚¤ë§ˆë¡œ ê°€ì ¸ì˜¤ëŠ” ë‘ ê°€ì§€ ë°©ë²•ì´ ìˆë‹¤. ì„ íƒí•˜ëŠ” ì ‘ê·¼ ë°©ì‹ì— ë”°ë¼ ê¸°ë³¸ Prisma ì›Œí¬í”Œë¡œê°€ ë‹¤ë¥´ê²Œ ë³´ì¼ ìˆ˜ ìˆë‹¤.

## Prisma Migrate

Prismaì˜ í†µí•© ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ë„êµ¬ì¸ Prisma Migrateë¥¼ ì‚¬ìš©í•˜ëŠ” ìœ„í¬í”Œë¡œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

1. Prisma Data modelì„ ìˆ˜ë™ìœ¼ë¡œ ì¡°ì •
2. `prisma migrate dev` CLI ëª…ë ¹ì„ ì‚¬ìš©í•´ ê°œë°œ ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
3. ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œì—ì„œ Prisma Clientë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì— ì•¡ì„¸ìŠ¤

![Untitled](./upload/1.png)

## SQL migrations ë° introspection(ë‚´ë¶€ê²€ì‚¬)

ì–´ë–¤ ì´ìœ ë¡œ Prisma Migrateë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ê±°ë‚˜ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë ¤ëŠ” ê²½ìš°ì—ë„ ìì²´ ê²€ì‚¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆì—ì„œ Prisma ìŠ¤í‚¤ë§ˆë¥¼ ì—…ë°ì´íŠ¸ í•  ìˆ˜ ìˆë‹¤. SQL ë§ˆì´ê·¸ë ˆì´ì…˜ ë° ë‚´ë¶€ê²€ì‚¬ë¥¼ ì‚¬ìš©í•  ë•Œì˜ ì¼ë°˜ì ì¸ ì›Œí¬í”Œë¡œëŠ” ì•½ê°„ ë‹¤ë¥´ë‹¤.

1. SQL ë˜ëŠ” migration ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ìˆ˜ë™ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì¡°ì •
2. (ì¬) ë°ì´í„°ë² ì´ìŠ¤ ê²€ì‚¬
3. ì„ íƒì ìœ¼ë¡œ Prisma Client APIë¥¼ (ì¬)êµ¬ì„±í•œë‹¤.
4. (ì¬) Prisma Client ìƒì„±
5. ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œì—ì„œ Prisma Clientë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ì— ì•¡ì„¸ìŠ¤

![Untitled](./upload/2.png)
